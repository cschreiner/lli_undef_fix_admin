#!/bin/sh
# compress PASSED files created by run_ir_ftn_mktest_lli

do_one_dir()
{
   if [ $# -eq 0 ]; then
      arg_start_dir=.
   else
      arg_start_dir="$1"
   fi

   cd "$arg_start_dir"
   for passed_dir in `find . -type d -iname PASSED`; do
      start_dir=`pwd`
      passed_parent=`dirname $passed_dir`
      echo " "
      echo =================================================================
      echo compressing in dir \"$passed_parent\"
      if ls -1 $passed_dir/*tar.bz2 | grep -q ^; then
         echo "  " dir is already compressed
      else
	 cd $passed_parent
	 tar -cvjf /tmp/PASSED.tar.bz2 PASSED && \
	    rm -rf PASSED && \
	    mkdir PASSED && \
	    mv /tmp/PASSED.tar.bz2 PASSED
	 cd $start_dir
      fi
   done
}

for dir in "$@"; do
   do_one_dir $dir
done

