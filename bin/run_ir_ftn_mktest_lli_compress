#!/bin/sh
# compress PASSED files created by run_ir_ftn_mktest_lli

do_one_dir()
{
   if [ $# -eq 0 ]; then
      arg_work_dir=.
   else
      arg_work_dir="$1"
   fi
   if [ ! -d "$arg_work_dir" ]; then
      echo Error: this does not seem to be a directory:
      echo "  " \"$arg_work_dir\"
      echo "  " pwd=\"`pwd`\"
      return 127
   fi

   start_dir=`pwd`
   cd "$arg_work_dir"
   for passed_dir in `find . -type d -iname PASSED`; do
      passed_parent=`dirname $passed_dir`
      echo " "
      echo =================================================================
      echo compressing in dir \"$passed_parent\"
      if ls -1 $passed_dir/*tar.bz2 | grep -q ^; then
         echo "  " dir is already compressed
      else
	 cd $passed_parent
	 tar -cvjf /tmp/PASSED.tar.bz2 PASSED && \
	    rm -rf PASSED && \
	    mkdir PASSED && \
	    mv /tmp/PASSED.tar.bz2 PASSED
      fi
   done
   cd $start_dir
}

for dir in "$@"; do
   do_one_dir $dir
done

