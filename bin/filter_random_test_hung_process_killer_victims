#!/bin/bash
# Takes on stdin a set of files generated by run_csmith_lli or similar, and
# filters for those generated by runs that apparently got killed by the
# program random_test_hung_process_killer. 

for ii in `cat /dev/stdin`; do
   bb=`basename $ii .report`
   bb_dir=`dirname $ii`
   bb_0_stderr=$bb_dir/${bb}_o0.ll.stderr
   bb_3_stderr=$bb_dir/${bb}_o3.ll.stderr

   grep -qiE '\bkilled\b' $bb_0_stderr
   bb_0_killed=$?
   grep -qiE '\bkilled\b' $bb_3_stderr
   bb_3_killed=$?
   bb_0_len=`stat --printf="%s\n" $bb_0_stderr`
   bb_3_len=`stat --printf="%s\n" $bb_3_stderr`

   if [ $bb_0_killed -eq 0 -a $bb_3_len -eq 0 -o \
         $bb_3_killed -eq 3 -a -$bb_0_len -eq 0 -o \
         $bb_0_killed -eq 0 -a $bb_3_killed -eq 0 ]; then 
      echo $ii
    fi
done



